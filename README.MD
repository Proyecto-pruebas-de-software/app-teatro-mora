# Teatro Mora Virtual

¬°Bienvenido al sistema del Teatro Mora Virtual! Esta aplicaci√≥n integral est√° dise√±ada para gestionar eventos teatrales, permitir la interacci√≥n de la comunidad a trav√©s de un foro, y facilitar la compra de boletos y la gesti√≥n de una cola virtual. Desarrollado con una arquitectura moderna de Node.js/Express para el backend y React para el frontend, junto con PostgreSQL como base de datos.

## Tabla de Contenidos
- [Teatro Mora Virtual](#teatro-mora-virtual)
  - [Tabla de Contenidos](#tabla-de-contenidos)
  - [Tecnolog√≠as Utilizadas](#tecnolog√≠as-utilizadas)
  - [Caracter√≠sticas Principales](#caracter√≠sticas-principales)
  - [Estructura del Proyecto](#estructura-del-proyecto)
  - [Configuraci√≥n e Instalaci√≥n](#configuraci√≥n-e-instalaci√≥n)
    - [Prerrequisitos](#prerrequisitos)
    - [Pasos de Instalaci√≥n](#pasos-de-instalaci√≥n)
  - [Uso de la Aplicaci√≥n](#uso-de-la-aplicaci√≥n)
  - [Consideraciones y Mejoras Futuras](#consideraciones-y-mejoras-futuras)
  - [Endpoints Disponibles](#endpoints-disponibles)
    - [Usuarios](#usuarios)
    - [Actores](#actores)
    - [Mensajes del Foro](#mensajes-del-foro)
    - [Boletos](#boletos)
    - [Cola Virtual](#cola-virtual)
    - [Eventos](#eventos)
    - [Autenticaci√≥n](#autenticaci√≥n)
  - [Testing](#testing)
  - [Despliegue (Futuro)](#despliegue-futuro)
  - [Contribuci√≥n](#contribuci√≥n)
  - [üìÑ Licencia](#-licencia)

## Tecnolog√≠as Utilizadas

**Backend:**
-   **Node.js**: Entorno de ejecuci√≥n para JavaScript.
-   **Express.js**: Framework web para Node.js.
-   **PostgreSQL**: Sistema de gesti√≥n de bases de datos relacionales.
-   **`pg`**: Cliente PostgreSQL para Node.js.
-   **`bcryptjs`**: Librer√≠a para el hashing de contrase√±as.
-   **`jsonwebtoken` (JWT)**: Para la autenticaci√≥n basada en tokens.
-   **`dotenv`**: Para la gesti√≥n de variables de entorno.

**Frontend:**
-   **React**: Librer√≠a de JavaScript para construir interfaces de usuario.
-   **Vite**: Herramienta de construcci√≥n r√°pida para proyectos web.
-   **Material-UI (MUI)**: Librer√≠a de componentes React para un dise√±o atractivo y responsivo.
-   **`@tanstack/react-query`**: Para la gesti√≥n de estados as√≠ncronos y cach√© de datos.
-   **`axios`**: Cliente HTTP para realizar peticiones a la API.

**Otros:**
-   **Mocha & Chai**: Frameworks de testing (principalmente para el backend).
-   **`cross-env`**: Para configurar variables de entorno de manera multiplataforma.

## Caracter√≠sticas Principales

*   **Gesti√≥n de Usuarios**: Registro, inicio de sesi√≥n, perfiles de usuario (clientes y administradores) y hashing de contrase√±as para mayor seguridad.
*   **Gesti√≥n de Eventos**:
    *   Visualizaci√≥n de eventos pr√≥ximos y pasados, incluyendo detalles como hora, precio, aforo, y URL de imagen.
    *   Funcionalidad para crear, editar y eliminar eventos (solo administradores).
    *   Filtrado y ordenamiento de eventos por nombre, fecha y precio (ascendente/descendente).
*   **Foro de la Comunidad**:
    *   Publicaci√≥n de mensajes asociados a eventos, con soporte para respuestas a mensajes existentes (foro anidado).
    *   Visualizaci√≥n de mensajes con detalles de autor, fecha, contenido, **conteo de respuestas y fecha de √∫ltima actividad**.
    *   **Control de acceso granular para mensajes**: los usuarios solo pueden editar/eliminar sus propios mensajes y reportar otros. Los administradores tienen control total.
    *   Validaci√≥n en frontend para mensajes (m√≠nimo de 5 caracteres).
*   **Gesti√≥n de Actores**: Visualizaci√≥n y gesti√≥n de la informaci√≥n de los actores del teatro (solo administradores pueden crear, editar, eliminar).
*   **Boletos y Cola Virtual**:
    *   Sistema robusto de **compra de boletos**, incluyendo gesti√≥n de aforo y validaci√≥n de asientos.
    *   **Gesti√≥n completa de cola virtual** para eventos, permitiendo a los usuarios unirse, verificar su estado en la cola, y ser notificados de su turno.
    *   Integraci√≥n con la UI para la navegaci√≥n f√°cil de regreso al evento desde la p√°gina de la cola.
*   **Interfaz de Usuario Responsiva**: Dise√±o adaptado a diferentes tama√±os de pantalla utilizando Material-UI.

## Estructura del Proyecto

El proyecto est√° dividido en dos directorios principales: `api/` para el backend y `src/` para el frontend.

```
.
‚îú‚îÄ‚îÄ api/                  # C√≥digo del backend (Node.js/Express)
‚îÇ   ‚îú‚îÄ‚îÄ database/         # Scripts SQL para la base de datos (schema, seed)
‚îÇ   ‚îú‚îÄ‚îÄ middleware/       # Funciones middleware reutilizables (e.g., autenticaci√≥n)
‚îÇ   ‚îú‚îÄ‚îÄ models/           # Definiciones de modelos de datos y respuesta API
‚îÇ   ‚îú‚îÄ‚îÄ queries/          # L√≥gica de interacci√≥n con la base de datos (CRUD)
‚îÇ   ‚îú‚îÄ‚îÄ routes/           # Definici√≥n de las rutas de la API (endpoints)
‚îÇ   ‚îú‚îÄ‚îÄ tests/            # Pruebas para el backend
‚îÇ   ‚îî‚îÄ‚îÄ index.js          # Punto de entrada de la API
‚îÇ
‚îú‚îÄ‚îÄ src/                  # C√≥digo del frontend (React/Vite)
‚îÇ   ‚îú‚îÄ‚îÄ assets/           # (Opcional) Archivos est√°ticos como im√°genes
‚îÇ   ‚îú‚îÄ‚îÄ components/       # Componentes React reutilizables (botones, tarjetas, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ context/          # Contextos de React para la gesti√≥n de estado global (e.g., AuthContext)
‚îÇ   ‚îú‚îÄ‚îÄ pages/            # Componentes React de las p√°ginas principales (vistas)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Foro.jsx      # P√°gina principal del foro, muestra categor√≠as de eventos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ EventForumPage.jsx # P√°gina de un foro de evento espec√≠fico (temas y respuestas)
‚îÇ   ‚îú‚îÄ‚îÄ main.jsx          # Punto de entrada principal de la aplicaci√≥n React
‚îÇ   ‚îî‚îÄ‚îÄ App.jsx           # Componente principal de la aplicaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ theme.js          # Configuraci√≥n del tema de Material-UI
‚îÇ
‚îú‚îÄ‚îÄ index.html            # Plantilla HTML principal para la aplicaci√≥n React
‚îú‚îÄ‚îÄ package.json          # Metadatos del proyecto y dependencias
‚îú‚îÄ‚îÄ package-lock.json     # Registro exacto de las dependencias
‚îú‚îÄ‚îÄ vite.config.js        # Configuraci√≥n de Vite
‚îî‚îÄ‚îÄ README.MD             # Este archivo
```

## Configuraci√≥n e Instalaci√≥n

Sigue estos pasos para configurar y ejecutar el proyecto en tu m√°quina local.

### Prerrequisitos

Aseg√∫rate de tener instalado lo siguiente:
*   [**Node.js**](https://nodejs.org/): Versi√≥n 14 o superior.
*   [**npm**](https://www.npmjs.com/): Se instala con Node.js.
*   [**PostgreSQL**](https://www.postgresql.org/download/): Servidor de base de datos.
*   **pgAdmin 4** (Opcional, pero recomendado para gestionar la DB): Cliente gr√°fico para PostgreSQL.

### Pasos de Instalaci√≥n

1.  **Clonar el Repositorio:**
    ```bash
    git clone https://github.com/tu-usuario/app-teatro-mora.git
    cd app-teatro-mora
    ```

2.  **Configuraci√≥n de la Base de Datos:**
    *   **Crear base de datos:** Abre pgAdmin 4 o tu cliente PostgreSQL y crea una nueva base de datos llamada `teatro_mora_virtual`.
    *   **Crear archivo `.env`:** En el directorio `api/`, crea un archivo llamado `.env` y a√±ade el siguiente contenido, reemplazando los valores con tus credenciales de PostgreSQL y una clave secreta fuerte:
        ```
        # Database Configuration
        DB_USER=postgres
        DB_HOST=localhost
        DB_NAME=teatro_mora_virtual
        DB_PASSWORD=tu_contrase√±a_postgresql
        DB_PORT=5432

        # JWT Configuration
        JWT_SECRET=tu_clave_secreta_jwt_fuerte_y_unica

        # Server Configuration
        PORT=3000
        NODE_ENV=development
        ```
        **Importante:** Aseg√∫rate de que `DB_PASSWORD` coincida con la contrase√±a de tu usuario `postgres` en PostgreSQL. `JWT_SECRET` debe ser una cadena de caracteres aleatoria y segura.
    *   **Ejecutar esquema y datos de prueba:** Navega al directorio `api/` y ejecuta el script SQL para crear las tablas y poblar datos de prueba:
        ```bash
        cd api
        psql -U postgres -d teatro_mora_virtual -f database/full_init.sql
        ```
        (Reemplaza `postgres` con tu usuario de PostgreSQL si es diferente).

3.  **Instalar Dependencias del Backend:**
    A√∫n en el directorio `api/`:
    ```bash
    npm install
    ```

4.  **Iniciar el Servidor Backend:**
    Desde el directorio `api/`:
    ```bash
    npm start
    # O para desarrollo con reinicio autom√°tico (si tienes nodemon):
    # npm run dev
    ```
    El servidor backend se ejecutar√° en `http://localhost:3000` (o el puerto que configures en `.env`).

5.  **Instalar Dependencias del Frontend:**
    Regresa al directorio ra√≠z del proyecto (`app-teatro-mora`) y luego instala las dependencias del frontend:
    ```bash
    cd ..
    npm install
    ```

6.  **Iniciar el Servidor de Desarrollo del Frontend:**
    Desde el directorio ra√≠z del proyecto:
    ```bash
    npm run dev
    ```
    El frontend se ejecutar√° en `http://localhost:3001` (o un puerto similar, seg√∫n Vite).

## Uso de la Aplicaci√≥n

Una vez que ambos servidores (backend y frontend) est√©n en funcionamiento:
1.  Abre tu navegador y navega a la URL del frontend (ej: `http://localhost:3001`).
2.  Puedes registrarte como un nuevo usuario o usar las credenciales de prueba predefinidas en `database/full_init.sql` (ej: `admin@example.com` / `Admin123!`).
3.  Explora las secciones de Eventos, Foro, Actores, etc.

## Consideraciones y Mejoras Futuras

Aunque el proyecto ha avanzado significativamente y es funcional, aqu√≠ hay algunas √°reas para futuras mejoras y consideraciones:

*   **Refactorizaci√≥n de Autenticaci√≥n**: La l√≥gica de autenticaci√≥n ha sido parcialmente refactorizada, moviendo el hashing de contrase√±as y la funci√≥n de login a `api/queries/queries_usuarios.js`. A√∫n se puede revisar para una separaci√≥n m√°s estricta de capas.
*   **Validaci√≥n de Datos en Frontend**: Se ha implementado validaci√≥n b√°sica en el lado del cliente para el formulario de mensajes del foro. Se recomienda extender estas validaciones a otros formularios (ej. eventos, actores) para una experiencia de usuario m√°s robusta.
*   **Manejo de Errores UX**: Se ha a√±adido un mensaje de advertencia para la validaci√≥n de mensajes del foro. Se puede mejorar la presentaci√≥n general de errores al usuario en el frontend para una experiencia m√°s fluida y consistente.
*   **Gesti√≥n Completa de Boletos y Cola**: Se ha implementado un sistema robusto de compra de boletos y una gesti√≥n de cola virtual funcional en el backend. Las mejoras futuras podr√≠an centrarse en una interfaz de usuario m√°s interactiva y en la integraci√≥n en tiempo real (websockets) para la gesti√≥n de la cola y asientos.
*   **Paginaci√≥n/Scroll Infinito**: Para listas grandes de eventos o mensajes, implementar paginaci√≥n o carga infinita para mejorar el rendimiento y la experiencia del usuario.
*   **Tests de Frontend**: A√±adir pruebas unitarias y de integraci√≥n para los componentes de React para asegurar la estabilidad y prevenir regresiones.
*   **Estilos y Temas**: Considerar un sistema de temas m√°s avanzado o una mayor personalizaci√≥n de estilos si se planea una evoluci√≥n visual profunda.

---
Espero que este `README.MD` te sea de gran utilidad para entender y gestionar tu proyecto. ¬°Mucho √©xito!

## Endpoints Disponibles

### Usuarios
- `GET /usuarios` - Listar todos los usuarios
- `GET /usuarios/:id` - Obtener usuario por ID
- `POST /usuarios` - Crear nuevo usuario
- `PUT /usuarios/:id` - Actualizar usuario
- `DELETE /usuarios/:id` - Eliminar usuario

### Actores
- `GET /actores` - Listar todos los actores
- `GET /actores/:id` - Obtener actor por ID
- `POST /actores` - Crear nuevo actor
- `PUT /actores/:id` - Actualizar actor
- `DELETE /actores/:id` - Eliminar actor

### Mensajes del Foro
- `GET /api/mensajes` - Listar todos los mensajes del foro (puede filtrar por `evento_id` o `parent_id`)
- `GET /api/mensajes/:evento_id` - Listar mensajes de un evento espec√≠fico
- `GET /api/mensajes/replies/:parent_id` - Listar respuestas a un mensaje espec√≠fico
- `POST /api/mensajes` - Crear nuevo mensaje (requiere autenticaci√≥n)
- `PUT /api/mensajes/:id` - Actualizar mensaje (requiere autenticaci√≥n, solo autor o admin)
- `DELETE /api/mensajes/:id` - Eliminar mensaje (requiere autenticaci√≥n, solo autor o admin)
- `POST /api/mensajes/reportar/:id` - Reportar un mensaje (requiere autenticaci√≥n)

### Boletos
- `GET /api/boletos` - Listar todos los boletos
- `GET /api/boletos/:id` - Obtener boleto por ID
- `POST /api/boletos` - Crear nuevo boleto (requiere autenticaci√≥n)
- `POST /api/boletos/comprar` - Comprar m√∫ltiples boletos para un evento (requiere autenticaci√≥n y estar en turno en la cola virtual)
- `PUT /api/boletos/:id` - Actualizar boleto (requiere autenticaci√≥n)
- `DELETE /api/boletos/:id` - Eliminar boleto (requiere autenticaci√≥n)

### Cola Virtual
- `GET /api/cola_virtual` - Listar todos los registros de la cola virtual
- `GET /api/cola_virtual/:id` - Obtener registro de cola virtual por ID
- `POST /api/cola_virtual` - Crear nuevo registro de cola virtual (requiere autenticaci√≥n)
- `POST /api/cola_virtual/join` - Unirse a la cola virtual para un evento (requiere autenticaci√≥n)
- `GET /api/cola_virtual/status/:evento_id` - Obtener el estado del usuario en la cola para un evento (requiere autenticaci√≥n)
- `GET /api/cola_virtual/length/:evento_id` - Obtener la longitud de la cola para un evento
- `PUT /api/cola_virtual/:id` - Actualizar registro de cola virtual (requiere autenticaci√≥n)
- `DELETE /api/cola_virtual/:id` - Eliminar registro de cola virtual (requiere autenticaci√≥n)

### Eventos
- `GET /api/eventos` - Listar todos los eventos
- `GET /api/eventos/:id` - Obtener evento por ID
- `POST /api/eventos` - Crear nuevo evento (requiere autenticaci√≥n y rol de administrador)
- `PUT /api/eventos/:id` - Actualizar evento (requiere autenticaci√≥n y rol de administrador)
- `DELETE /api/eventos/:id` - Eliminar evento (requiere autenticaci√≥n y rol de administrador)

### Autenticaci√≥n
- `POST /api/auth/register` - Registrar un nuevo usuario
- `POST /api/auth/login` - Iniciar sesi√≥n de usuario
- `GET /api/auth/me` - Obtener informaci√≥n del usuario autenticado (requiere token)

## Testing
Pruebas unitarias y de integraci√≥n, con Mocha + Chai.
Iniciar tests:
```bash
npm test
```
Se mostraran en consola el resultado de un total de 112 
tests centrados en cada request de caso general y de casos limites
para cada modulo CRUD.

## Despliegue (Futuro)
Planeado para AWS EC2 + RDS. Consultar con el equipo.


##  Contribuci√≥n

1. **Clonar el repositorio** (si no lo has hecho):
   ```bash
   git clone https://github.com/Proyecto-pruebas-de-software/app-teatro-mora.git
   cd app-teatro-mora/api
   ```

2. **Crear una rama nueva** (usar nombres descriptivos con prefijos):
   ```bash
   git checkout -b tipo/descripci√≥n-breve
   ```
   Ejemplos:
   - `feat/add-login` (para nuevas funcionalidades)
   - `fix/eventos-query` (para correcciones)
   - `docs/update-readme` (para documentaci√≥n)

3. **Instalar dependencias** (en caso de ser la primera vez):
   ```bash
   npm install
   ```

4. **Hacer tus cambios** y verificar que el servidor funcione:
   ```bash
   npm start
   ```

5. **Hacer commit** con mensajes claros ([Conventional Commits](https://www.conventionalcommits.org/)):
   ```bash
   git add .
   git commit -m "feat: a√±ade endpoint para gesti√≥n de boletos"
   ```

6. **Sincronizar tu rama** con `main` (antes de subir cambios):
   ```bash
   git pull origin main
   ```

7. **Subir cambios** a tu fork:
   ```bash
   git push origin nombre-de-tu-rama
   ```

8. **Abrir un Pull Request (PR)** en GitHub:
   - Describe los cambios y **mencionar a @cvarela3344** (Claudio) como revisor.
   - Adjuntar capturas o resultados de pruebas si son relevantes.


## üìÑ Licencia

MIT ¬© 2024 - Equipo Teatro Mora Virtual
